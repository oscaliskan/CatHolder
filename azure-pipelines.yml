trigger:
  branches:
    include:
      - master

pool:
  name: "default"

variables:
  buildConfiguration: 'Release'
  system_accesstoken: $(System.AccessToken)  # OAuth token'ı değişken olarak tanımla

steps:
- script: |
    echo y | "C:\Users\oscal\AppData\Local\Android\Sdk/cmdline-tools/latest/bin/sdkmanager" --licenses
  displayName: 'Android Lisanslarını Kabul Et (Windows)'

- task: Gradle@2
  inputs:
    gradleWrapperFile: 'gradlew'
    tasks: 'assembleRelease'
    publishJUnitResults: false

- task: CopyFiles@2
  inputs:
    contents: '**/*.apk'
    targetFolder: '$(Build.ArtifactStagingDirectory)'

- task: PublishBuildArtifacts@1
  inputs:
    pathtoPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: 'APK'

# Python script'ini çalıştır
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.x'
  displayName: 'Python Versiyonunu Ayarla'

- script: |
    python pr_commenter.py
  displayName: 'PR Değişikliklerini Kontrol Et ve Yorum Yap'
  env:
    SYSTEM_ACCESSTOKEN: $(system_accesstoken)  # Token'ı ortam değişkeni olarak ayarla
