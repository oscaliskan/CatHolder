trigger:
  branches:
    include:
      - master

pool:
  name: "default"

variables:
  buildConfiguration: 'Release'

steps:
- script: |
    echo y | "C:\Users\oscal\AppData\Local\Android\Sdk/cmdline-tools/latest/bin/sdkmanager" --licenses
  displayName: 'Android Lisanslarını Kabul Et (Windows)'

- task: Gradle@2
  inputs:
    gradleWrapperFile: 'gradlew'
    tasks: 'assembleRelease'
    publishJUnitResults: false

- task: CopyFiles@2
  inputs:
    contents: '**/*.apk'
    targetFolder: '$(Build.ArtifactStagingDirectory)'

- task: PublishBuildArtifacts@1
  inputs:
    pathtoPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: 'APK'

# ———————— Aşağıyı ekleyin ————————

# 1) Checkout ve credential koruma
- checkout: self
  persistCredentials: true

# 3) PR kontrol & yorum script'i
- script: python pr_commenter.py
  displayName: 'PR Değişikliklerini Kontrol Et ve Yorum Yap'
  env:
    SYSTEM_ACCESSTOKEN: $(System.AccessToken)